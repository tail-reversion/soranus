% fontsize.tex
% Copyright (C) 2018 Kelly Smith.
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License (LPPL),
% either version 1.3c of this license or (at your option)
% any later version. The latest version of this license
% is in the file:
%
%   http://www.latex-project.org/lppl.txt
%
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is Kelly Smith.
%
% This work consists of the files listed in the README.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Template
%

% Define an object that represents a font size command.
\DeclareObjectType { fontsize } { 0 }


% Define the interface for the standard (only) font size template.
\DeclareTemplateInterface { fontsize } { standard } { 0 }
  {
    point-size     : length  = 10pt,
    baseline-scale : real    = 1.2
  }


% I forbid normal font size switches in the middle of a math environment.
\msg_new:nnnn { soranus } { fontsize-in-math-mode }
  { Normal~font~size~commands~are~forbidden~in~math~mode. }
  {
    If~you~need~to~have~differently-sized~math,~invoke~a~font~size~command~
    before~the~math~environment.
  }


%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
% Implementation
%

% Here I define the template variables.

\dim_new:N \l__soranus_fontsize_point_size_dim
\fp_new:N \l__soranus_fontsize_baseline_scale_fp


\DeclareTemplateCode { fontsize } { standard } { 0 }
  {
    point-size     = \l__soranus_fontsize_point_size_dim,
    baseline-scale = \l__soranus_fontsize_baseline_scale_fp
  }
  {
    \mode_if_math:TF
      { \msg_error:nn { soranus } { fontsize-in-math-mode } }
      {
        \AssignTemplateKeys
        % I do not use \@setfontsize since I handle math mode in my own way
        % and because \@currsize is not used in this class.
        \fontsize
          \l__soranus_fontsize_point_size_dim
          {
            \ScaleToNearestTenthPoint
              { \l__soranus_fontsize_point_size_dim }
              { \l__soranus_fontsize_baseline_scale_fp }
          }
        \selectfont
      }
  }


%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
% Instances
%
% The default values for these instances make the font size and baseline scale
% of each font size dependent on the normal font size and baseline scale, which
% are set with class options.

\NewDocumentCommand \DeclareFontSize { m m }
  { \DeclareInstance { fontsize } { #1 } { standard } { #2 } }

\NewDocumentCommand \EditFontSize { m m }
  { \EditInstance { fontsize } { #1 } { #2 } }

\NewDocumentCommand \UseFontSize { m }
  { \UseInstance { fontsize } { #1 } }


\DeclareFontSize { miniscule }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 0.5 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { tiny }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 0.6 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { scriptsize }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 0.7 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { footnotesize }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 0.8 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { small }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 0.9 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { normalsize }
  {
    point-size     = \NormalPointSize,
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { large }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 1.2 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { Large }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 1.4 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { LARGE }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 1.6 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { huge }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 2.4 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { Huge }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 2.8 },
    baseline-scale = \NormalBaselineScale
  }

\DeclareFontSize { HUGE }
  {
    point-size     = \ScaleToNearestTenthPoint { \NormalPointSize } { 3.2 },
    baseline-scale = \NormalBaselineScale
  }




%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
% Document Size Commands
%
% A font size command is changed by editing its respective instance.

\NewDocumentCommand \miniscule { }
  { \UseFontSize { miniscule } }

\NewDocumentCommand \tiny { }
  { \UseFontSize { tiny } }

\NewDocumentCommand \scriptsize { }
  { \UseFontSize { scriptsize } }

\NewDocumentCommand \footnotesize { }
  { \UseFontSize { footnotesize } }

\NewDocumentCommand \small { }
  { \UseFontSize { small } }

\RenewDocumentCommand \normalsize { }
  { \UseFontSize { normalsize } }

\NewDocumentCommand \large { }
  { \UseFontSize { large } }

\NewDocumentCommand \Large { }
  { \UseFontSize { Large } }

\NewDocumentCommand \LARGE { }
  { \UseFontSize { LARGE } }

\NewDocumentCommand \huge { }
  { \UseFontSize { huge } }

\NewDocumentCommand \Huge { }
  { \UseFontSize { Huge } }

\NewDocumentCommand \HUGE { }
  { \UseFontSize { HUGE } }

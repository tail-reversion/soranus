% pagestyle.tex
% Copyright (C) 2018-2020 Kelly Smith.
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License (LPPL),
% either version 1.3c of this license or (at your option)
% any later version. The latest version of this license
% is in the file:
%
%   http://www.latex-project.org/lppl.txt
%
% This work has the LPPL maintenance status `maintained'.
% 
% The Current Maintainer of this work is Kelly Smith.
%
% This work consists of the files listed in the README.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Designer Commands
%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Pagestyle
%

\DeclareObjectType { pagestyle } { 0 }


\DeclareTemplateInterface { pagestyle } { standard } { 0 }
  {
    page-numbering           : choice
      { arabic, small-roman, big-roman, small-letters, big-letters }
                                         = arabic,
    header-top-rule-width    : length    = 0pt,
    header-recto-left        : tokenlist,
    header-recto-center      : tokenlist = ---\enspace\{\,\thepage\,\}\enspace---,
    header-recto-right       : tokenlist,
    header-verso-left        : tokenlist,
    header-verso-center      : tokenlist = ---\enspace\{\,\thepage\,\}\enspace---,
    header-verso-right       : tokenlist,
    header-bottom-rule-width : length    = 0.4pt,
    footer-top-rule-width    : length    = 0.4pt,
    footer-recto-left        : tokenlist,
    footer-recto-center      : tokenlist,
    footer-recto-right       : tokenlist,
    footer-verso-left        : tokenlist,
    footer-verso-center      : tokenlist,
    footer-verso-right       : tokenlist,
    footer-bottom-rule-width : length    = 0pt,
  }


\NewCoffin \l__soranus_headfoot_a_coffin
\NewCoffin \l__soranus_headfoot_b_coffin
\NewCoffin \l__soranus_headfoot_c_coffin

\cs_new_protected:Nn \__soranus_typeset_headfoot:NNNNN
  {
    \SetHorizontalCoffin \l__soranus_headfoot_a_coffin
      {
        \hbox_to_wd:nn { \textwidth }
          {
            \parbox [ t ] { 0.3\textwidth }
              {
                \UseInstance { justification } { ragged-right }
                \tl_use:N #3 \strut
              }
            \skip_horizontal:n { 0pt plus 1fill }
            \parbox [ t ] { 0.3\textwidth }
              {
                \UseInstance { justification } { center }
                \tl_use:N #4 \strut
              }
            \skip_horizontal:n { 0pt plus 1fill }
            \parbox [ t ] { 0.3\textwidth }
              {
                \UseInstance { justification } { ragged-left }
                \tl_use:N #5 \strut
              }
          }
      }
    \dim_compare:nF { #1 = \c_zero_dim }
      {
        \SetHorizontalCoffin \l__soranus_headfoot_b_coffin
          { \rule { \textwidth } { #1 } }
        \JoinCoffins
          \l__soranus_headfoot_a_coffin [ l, t ]
          \l__soranus_headfoot_b_coffin [ l, b ]
          ( 0pt, 3pt )
      }
    \dim_compare:nF { #2 = \c_zero_dim }
      {
        \SetHorizontalCoffin \l__soranus_headfoot_b_coffin
          { \rule { \textwidth } { #2 } }
        \JoinCoffins
          \l__soranus_headfoot_a_coffin [ l, b ]
          \l__soranus_headfoot_b_coffin [ l, t ]
          ( 0pt, -2pt )
      }
    \TypesetCoffin \l__soranus_headfoot_a_coffin ( 0pt, 2.5pt )
  }


\tl_new:N \g__soranus_pagestyle_standard_page_numbering_tl
\dim_new:N \g__soranus_pagestyle_standard_header_top_rule_width_dim
\tl_new:N \g__soranus_pagestyle_standard_header_recto_left_tl
\tl_new:N \g__soranus_pagestyle_standard_header_recto_center_tl
\tl_new:N \g__soranus_pagestyle_standard_header_recto_right_tl
\tl_new:N \g__soranus_pagestyle_standard_header_verso_left_tl
\tl_new:N \g__soranus_pagestyle_standard_header_verso_center_tl
\tl_new:N \g__soranus_pagestyle_standard_header_verso_right_tl
\dim_new:N \g__soranus_pagestyle_standard_header_bottom_rule_width_dim
\dim_new:N \g__soranus_pagestyle_standard_footer_top_rule_width_dim
\tl_new:N \g__soranus_pagestyle_standard_footer_recto_left_tl
\tl_new:N \g__soranus_pagestyle_standard_footer_recto_center_tl
\tl_new:N \g__soranus_pagestyle_standard_footer_recto_right_tl
\tl_new:N \g__soranus_pagestyle_standard_footer_verso_left_tl
\tl_new:N \g__soranus_pagestyle_standard_footer_verso_center_tl
\tl_new:N \g__soranus_pagestyle_standard_footer_verso_right_tl
\dim_new:N \g__soranus_pagestyle_standard_footer_bottom_rule_width_dim

\DeclareTemplateCode { pagestyle } { standard } { 0 }
  {
    page-numbering           =
      {
        arabic        = \pagenumbering { arabic },
        small-roman   = \pagenumbering { roman },
        big-roman     = \pagenumbering { Roman },
        small-letters = \pagenumbering { alph },
        big-letters   = \pagenumbering { Alph },
      },
    header-top-rule-width    = global \g__soranus_pagestyle_standard_header_top_rule_width_dim,
    header-recto-left        = global \g__soranus_pagestyle_standard_header_recto_left_tl,
    header-recto-center      = global \g__soranus_pagestyle_standard_header_recto_center_tl,
    header-recto-right       = global \g__soranus_pagestyle_standard_header_recto_right_tl,
    header-verso-left        = global \g__soranus_pagestyle_standard_header_verso_left_tl,
    header-verso-center      = global \g__soranus_pagestyle_standard_header_verso_center_tl,
    header-verso-right       = global \g__soranus_pagestyle_standard_header_verso_right_tl,
    header-bottom-rule-width = global \g__soranus_pagestyle_standard_header_bottom_rule_width_dim,
    footer-top-rule-width    = global \g__soranus_pagestyle_standard_footer_top_rule_width_dim,
    footer-recto-left        = global \g__soranus_pagestyle_standard_footer_recto_left_tl,
    footer-recto-center      = global \g__soranus_pagestyle_standard_footer_recto_center_tl,
    footer-recto-right       = global \g__soranus_pagestyle_standard_footer_recto_right_tl,
    footer-verso-left        = global \g__soranus_pagestyle_standard_footer_verso_left_tl,
    footer-verso-center      = global \g__soranus_pagestyle_standard_footer_verso_center_tl,
    footer-verso-right       = global \g__soranus_pagestyle_standard_footer_verso_right_tl,
    footer-bottom-rule-width = global \g__soranus_pagestyle_standard_footer_bottom_rule_width_dim
  }
  {
    \AssignTemplateKeys
    \cs_gset_protected:Npn \@mkboth { \markboth }
    \cs_gset_protected:Npn \@oddhead
      {
        \__soranus_typeset_headfoot:NNNNN
          \g__soranus_pagestyle_standard_header_top_rule_width_dim
          \g__soranus_pagestyle_standard_header_bottom_rule_width_dim
          \g__soranus_pagestyle_standard_header_recto_left_tl
          \g__soranus_pagestyle_standard_header_recto_center_tl
          \g__soranus_pagestyle_standard_header_recto_right_tl
      }
    \cs_gset_protected:Npn \@evenhead
      {
        \__soranus_typeset_headfoot:NNNNN
          \g__soranus_pagestyle_standard_header_top_rule_width_dim
          \g__soranus_pagestyle_standard_header_bottom_rule_width_dim
          \g__soranus_pagestyle_standard_header_verso_left_tl
          \g__soranus_pagestyle_standard_header_verso_center_tl
          \g__soranus_pagestyle_standard_header_verso_right_tl
      }
    \cs_gset_protected:Npn \@oddfoot
      {
        \__soranus_typeset_headfoot:NNNNN
          \g__soranus_pagestyle_standard_footer_top_rule_width_dim
          \g__soranus_pagestyle_standard_footer_bottom_rule_width_dim
          \g__soranus_pagestyle_standard_footer_recto_left_tl
          \g__soranus_pagestyle_standard_footer_recto_center_tl
          \g__soranus_pagestyle_standard_footer_recto_right_tl
      }
    \cs_gset_protected:Npn \@evenfoot
      {
        \__soranus_typeset_headfoot:NNNNN
          \g__soranus_pagestyle_standard_footer_top_rule_width_dim
          \g__soranus_pagestyle_standard_footer_bottom_rule_width_dim
          \g__soranus_pagestyle_standard_footer_verso_left_tl
          \g__soranus_pagestyle_standard_footer_verso_center_tl
          \g__soranus_pagestyle_standard_footer_verso_right_tl
      }
  }


%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
% Instance
%

\NewDocumentCommand \DeclarePageStyle { m m }
  { \DeclareInstance { pagestyle } { #1 } { standard } { #2 } }

\NewDocumentCommand \EditPageStyle { m m }
  { \EditInstance { pagestyle } { #1 } { #2 } }

\NewDocumentCommand \UsePageStyle { m }
  { \UseInstance { pagestyle } { #1 } }


\DeclarePageStyle { default } { }



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Designer Utilities
%
